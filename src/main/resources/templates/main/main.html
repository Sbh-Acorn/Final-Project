<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/font.css}">
    <link rel="stylesheet" th:href="@{/css/main.css}">
    <script defer th:src="@{/js/header.js}"></script>
    <script defer th:src="@{/js/main.js}"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        function loadNotification(){
            $.ajax({
                url: "/notification",
                type: "GET",
                success: function(response){
                    if(response.status === "fetch_success"){
                        console.log(response);
                        if(!response.notificationList || response.notificationList.length === 0){
                            $("#header_alarm_dropdown").html("<div><p>알림이 없습니다.</p></div>");
                            return;
                        }
                        let notificationHtml = "";
                        response.notificationList.forEach((notification) => {
                            notificationHtml += `
                                <div onclick="readNotification(this)"
                                data-notification-id="${notification.notificationId}"
                                data-product-id="${notification.productId}">
                                    <p>
                                        ${notification.productName}의 가격이 €${notification.previousPrice}에서
                                        €${notification.currentPrice}으로 하락했습니다.
                                        ${notification.read} ${notification.notificationId} ${notification.createdAt}
                                    </p>
                                </div>
                            `;
                        });
                        $("#header_alarm_dropdown").html(notificationHtml);
                    }
                },
                error: function(){}
            });
        }

        function readNotification(element){
            let notificationId = element.dataset.notificationId;
            let productId = element.dataset.productId;
            console.log(element);
            console.log(notificationId);
            console.log(productId);
            $.ajax({
                url: "/notification/read",
                type: "POST",
                data: {
                    notificationId: notificationId
                },
                success: function(response){
                    if(response.status === "update_success"){
                        window.location.href = "/product/" + productId;
                    }
                },
                error: function(xhr, status, error){}
            });
        }
    </script>
</head>
<body>

<th:block th:replace="fragments/header1 :: header"></th:block>

<main>
    <div id="banner_wrap">
        <div id="prev_btn_wrap" class="btn_wrap">
            <img th:src="@{/img/prev.svg}" alt="" class="btn">
        </div>
        <div id="next_btn_wrap" class="btn_wrap">
            <img th:src="@{/img/next.svg}" alt="" class="btn">
        </div>
        <ul id="banner">
            <li th:each="bi : ${BannerImages}" class="banner_img_wrap">
                <a th:href="@{/promotion}" target="_blank">
                    <img th:src="${bi}" alt="Banner Image" class="banner_img"/>
                </a>
            </li>
        </ul>
        <p id="random_text"></p>
    </div>
</main>
<footer>footer</footer>

</body>
</html>