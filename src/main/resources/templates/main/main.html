<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/font.css}">
    <link rel="stylesheet" th:href="@{/css/main.css}">
    <script defer th:src="@{/js/header.js}"></script>
    <script defer th:src="@{/js/main.js}"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        function loadNotification(){
            $.ajax({
                url: "/notification",
                type: "GET",
                success: function(response){
                    if(response.status === "fetch_success"){
                        console.log(response);
                        if(!response.notificationList || response.notificationList.length === 0){
                            $("#header_alarm_dropdown").html("<div><p>알림이 없습니다.</p></div>");
                            return;
                        }
                        let notificationHtml = "";
                        response.notificationList.forEach((notification) => {
                            notificationHtml += `
                                <div onclick="readNotification(this)"
                                data-notification-id="${notification.notificationId}"
                                data-product-id="${notification.productId}">
                                    <p>
                                        ${notification.productName}의 가격이 €${notification.previousPrice}에서
                                        €${notification.currentPrice}으로 하락했습니다.
                                        ${notification.read} ${notification.notificationId}
                                    </p>
                                </div>
                            `;
                        });
                        $("#header_alarm_dropdown").html(notificationHtml);
                    }
                },
                error: function(){}
            });
        }

        function readNotification(element){
            let notificationId = element.dataset.notificationId;
            let productId = element.dataset.productId;
            console.log(element);
            console.log(notificationId);
            console.log(productId);
            $.ajax({
                url: "/notification/read",
                type: "POST",
                data: {
                    notificationId: notificationId
                },
                success: function(response){
                    if(response.status === "update_success"){
                        window.location.href = "/product/" + productId;
                    }
                },
                error: function(xhr, status, error){}
            });
        }
    </script>
</head>
<body>

<header>
    <div id="logo_wrap">
        <h1 id="logo">CALTIZM</h1>
    </div>
    <div id="wrap_wrap">
        <div id="wrap1">
            <div id="header_input_wrap">
                <input type="text" id="header_input" placeholder="상품명을 입력하세요" autocomplete="off">
                <img th:src="@{/img/header_search.svg}" alt="" id="header_search">

                <!-- 검색 결과 목록 -->
                <div id="search_results" class="search-dropdown">
                    <ul>

                    </ul>
                </div>
            </div>
            <div id="header_icon_wrap">
                <!-- 알림 아이콘 -->
                <img th:src="@{/img/header_alarm.svg}" alt="" id="header_alarm" class="header_icon"
                     onclick="loadNotification()">
                <div id="header_alarm_dropdown">
<!--                    <div class="notification" th:each="item : ${notificationList}"-->
<!--                         onclick="readNotification(this)" th:data-notification-id="${item.notificationId}">-->
<!--                        <p th:text="|${item.productName}의 가격이 €${item.previousPrice}에서-->
<!--                        €${item.currentPrice}으로 하락했습니다. ${item.isRead} ${item.notificationId}|">-->
<!--                        </p>-->
<!--                    </div>-->
                </div>

                <!-- 프로필 아이콘 -->
                <img th:src="@{/img/header_profile.svg}" alt="" id="header_profile" class="header_icon">

                <!-- 로그인/회원가입 메뉴 -->
                <ul id="header_profile_dropdown" class="dropdown" th:if="${sessionEmail == null}">
                    <li class="header_profile_dropdown_list">
                        <a th:href="@{/login}">로그인</a>
                    </li>
                    <li class="header_profile_dropdown_list">
                        <a th:href="@{/signup}">회원가입</a>
                    </li>
                </ul>

                <!-- 로그아웃/마이페이지 메뉴 -->
                <ul id="header_profile_dropdown2" class="dropdown" th:if="${sessionEmail != null}">
                    <li class="header_profile_dropdown_list">
                        <a th:href="@{/logout}">로그아웃</a>
                    </li>
                    <li class="header_profile_dropdown_list">
                        <a th:href="@{/myPage}">마이페이지</a>
                    </li>
                </ul>

                <!-- 장바구니 아이콘 -->
                <img th:src="@{/img/header_bucket.svg}" alt="" id="header_bucket" class="header_icon">
            </div>
        </div>
        <div id="wrap2">
            <ul id="header_nav">
                <li class="header_list">ALL</li>
                <li class="header_list">BRAND</li>
                <li class="header_list">FTA</li>
                <li class="header_list">TAX</li>
                <li class="header_list">COMMUNITY</li>
            </ul>
        </div>
    </div>
</header>
<main>
    <div id="banner_wrap">
        <div id="prev_btn_wrap" class="btn_wrap">
            <img th:src="@{/img/prev.svg}" alt="" class="btn">
        </div>
        <div id="next_btn_wrap" class="btn_wrap">
            <img th:src="@{/img/next.svg}" alt="" class="btn">
        </div>
        <ul id="banner">
            <li th:each="bi : ${BannerImages}">
                <a th:href="@{/promotion}" target="_blank">
                    <img th:src="${bi}" alt="Banner Image" />
                </a>
            </li>
        </ul>
        <p id="random_text">This is the Random Text</p>
    </div>
</main>
<footer>footer</footer>

</body>
</html>